# 2025 年 6 月 6 日（金）

## 学んだこと

- 映画レビューアプリ作成

1. モックサーバー（JSON Server）構築とエンドポイント準備
   db.json に reviews 配列を追加

例：
・id
・movieId（どの映画へのレビューか）
・user（投稿者の識別文字列）
・user（投稿者の識別文字列）
・rating（星評価、数値）
・comment（テキストコメント）
・createdAt（投稿日時の ISO 文字列）

ターミナルで json-server --watch db.json --port 3000 を実行

/reviews で全レビュー取得

/reviews?movieId=123 のようにフィルター付き取得

2. Axios インスタンスを用意（src/api/index.js）
   任意の場所に Axios をまとめたファイルを作成

axios.create({ baseURL: "http://localhost:3000", timeout: 5000 }) でインスタンスを生成

他のファイルからは import { api } from "@/api" のように呼び出せるようエクスポート

3. サービス層として reviewService.js を作成（src/api/reviewService.js）
   取得用メソッド：fetchReviewsByMovie(movieId)

/reviews?movieId={movieId}&\_sort=createdAt&\_order=desc で最新順に取得

投稿用メソッド：postReview({ movieId, user, rating, comment })

createdAt に現在日時の ISO 文字列を付与し、POST /reviews で送信

4. 映画詳細ページ（MovieDetail.vue）への組み込み
   ReviewList.vue と ReviewForm.vue をインポート・components に登録

ルートパラメータから movieId を取得し、fetchMovie を呼び出して映画情報を表示

refreshKey を定義し、子コンポーネントからのイベントで値をインクリメントして再取得をトリガー

テンプレートでは ReviewList に movieId と refreshKey を渡し、ReviewForm には movieId と currentUser を渡す

5. ReviewList.vue の実装（src/components/ReviewList.vue）
   props：movieId（対象映画 ID）、refreshKey（再取得トリガー）

setup で reviews リアクティブ変数を定義

onMounted と watch(refreshKey) で fetchReviewsByMovie(movieId) を呼び、reviews を更新

テンプレートで v-for ループを使い、各レビューを Vuetify の v-list-item や v-rating で表示

レビューがない場合は v-alert で「まだレビューがありません」と表示

6. ReviewForm.vue の実装（src/components/ReviewForm.vue）
   props：movieId（対象映画 ID）、currentUser（投稿者情報）

setup で comment, rating, loading, error の ref を定義

テンプレートに v-textarea（コメント入力）、v-rating（星評価）、v-btn（投稿ボタン）を配置

onSubmit メソッド

rating と comment の両方が入力されているかバリデーション

postReview を呼び出して JSON Server に送信

成功したらコメントと星をリセットし、必要に応じて emit("review-posted") で親に通知

失敗時は error メッセージを設定、loading を false に戻す

7. Vuetify 3 のセットアップ確認
   main.js に Vuetify のスタイルとアイコンフォントを読み込む記述を追加

import "vuetify/styles"

import "@mdi/font/css/materialdesignicons.css"（Material Design Icons のインストールが必要）

createVuetify に components, directives, icons: { defaultSet: "mdi" } を渡す

App.vue が <v-app> でラップされていることを確認

8. ルーティング確認（MovieDetail ルート）
   router/index.js に以下のルートを登録済み

path: "/movie/:movieId"、name: "movie-detail"、component: MovieDetail、meta: { requiresAuth: true }

MovieSearch.vue で表示している MovieCard をクリックすると、/movie/{id} に遷移し、MovieDetail.vue が表示される流れ

9. 動作確認の手順
   npm install @mdi/font を含む必要な依存をインストール

npm run serve で開発サーバーを起動

ブラウザで /search にアクセスし、キーワードを入力して映画カードが表示されることを確認

映画カードをクリックし、/movie/{id} に遷移して MovieDetail.vue が表示されるか確認

MovieDetail.vue の下部に ReviewList（既存レビュー）と ReviewForm（投稿フォーム）が表示されるか確認

ReviewForm で星評価とコメントを入力し、「投稿する」をクリックすると、フォームがクリアされ、ReviewList に新着レビューが反映されることを確認

## 苦労したこと・できなかったこと

## 次やること（TODO）

## 参考リンク
